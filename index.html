<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØµÙØ­Ø© Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: Arial, sans-serif;
        }
        .header-title {
            text-align: center;
            font-size: 2rem;
            font-weight: bold;
            margin-top: 20px;
            color: #007bff;
        }
        .marquee-container {
            background-color: #007bff;
            color: white;
            padding: 10px;
            font-weight: bold;
            margin-top: 10px;
        }
        .news-card {
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease-in-out;
        }
        .news-card:hover {
            transform: scale(1.03);
        }
        .lazy-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: #ddd;
        }
        /* ØªØ®ØµÙŠØµ Ø´Ø±ÙŠØ· Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ© ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ */
        footer {
            background-color: #343a40;
            color: white;
            text-align: center;
            padding: 10px;
            position: relative;
        }
    </style>
</head>
<body>

    <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø© -->
    <div class="container">
        <h1 class="header-title">ğŸ“° Ø£Ø­Ø¯Ø« Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</h1>
    </div>

    <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…ØªØ­Ø±Ùƒ -->
    <div class="marquee-container">
        <marquee id="newsTicker" direction="left">ØªØ­Ù…ÙŠÙ„ Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø±...</marquee>
    </div>

    <div class="container mt-4">
        <!-- Ø²Ø± ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© -->
        <div class="d-flex justify-content-end mb-3">
            <select id="languageSelect" class="form-select w-auto">
                <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                <option value="en">English</option>
                <option value="fr">FranÃ§ais</option>
                <option value="es">EspaÃ±ol</option>
                <option value="de">Deutsch</option>
                <option value="it">Italiano</option>
            </select>
        </div>

        <!-- Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« -->
        <input type="text" id="searchInput" class="form-control mb-3" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ø®Ø¨Ø§Ø±...">

        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø®Ø¨Ø§Ø± -->
        <div id="newsContainer" class="row row-cols-1 row-cols-md-2 g-4"></div>

        <!-- Ø²Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯ -->
        <div class="text-center mt-4">
            <button id="loadMoreBtn" class="btn btn-primary">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯</button>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const newsContainer = document.getElementById("newsContainer");
            const loadMoreBtn = document.getElementById("loadMoreBtn");
            const searchInput = document.getElementById("searchInput");
            const newsTicker = document.getElementById("newsTicker");
            const languageSelect = document.getElementById("languageSelect");

            let newsData = [];
            let currentPage = 1;
            const newsPerPage = 4;
            const API_KEY = "NkwusezCRv-NB9S5PnWZVU5J0_7u8aLgMlu-Txhd5nVRBuTA"; 

            fetchNews();
            fetchNewsTicker();

            loadMoreBtn.addEventListener("click", () => {
                currentPage++;
                displayNews();
            });

            searchInput.addEventListener("input", (e) => {
                const query = e.target.value.toLowerCase();
                const filteredNews = newsData.filter(item => item.title.toLowerCase().includes(query));
                renderNews(filteredNews);
            });

            languageSelect.addEventListener("change", () => {
                fetchNews();
                fetchNewsTicker();
            });

            function fetchNews() {
                const lang = languageSelect.value;
                const apiUrl = `https://api.currentsapi.services/v1/latest-news?language=${lang}&apiKey=${API_KEY}`;

                fetch(apiUrl)
                    .then(response => response.json())
                    .then(data => {
                        // ØªØµÙÙŠØ© Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ø±Ø§Ø¨Ø·
                        newsData = data.news.filter(news => news.title && news.url); 
                        console.log("Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©:", newsData); 
                        currentPage = 1;
                        displayNews();
                    })
                    .catch(error => console.error("Error fetching news:", error));
            }

            function fetchNewsTicker() {
                const lang = languageSelect.value;
                const apiUrl = `https://api.currentsapi.services/v1/latest-news?language=${lang}&apiKey=${API_KEY}`;

                fetch(apiUrl)
                    .then(response => response.json())
                    .then(data => {
                        let headlines = data.news.map(article => article.title).slice(0, 5).join(" | ");
                        newsTicker.textContent = headlines;
                    })
                    .catch(error => console.error("Error fetching news ticker:", error));
            }

            function displayNews() {
                const start = (currentPage - 1) * newsPerPage;
                const end = start + newsPerPage;
                const newsSlice = newsData.slice(start, end);
                renderNews(newsSlice, start === 0);
            }

            function renderNews(newsArray, clear = false) {
                if (clear) newsContainer.innerHTML = "";

                let validNewsCount = 0;

                newsArray.forEach((news, index) => {
                    if (!news.title || !news.url) return; 

                    let adHtml = "";
                    if (validNewsCount > 0 && validNewsCount % 3 === 0) { 
                        adHtml = `<div class="col-12 text-center my-3">
                                    <img src="https://via.placeholder.com/728x90?text=Ø¥Ø¹Ù„Ø§Ù†+Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="img-fluid">
                                  </div>`;
                        newsContainer.innerHTML += adHtml;
                    }

                    const imageUrl = news.image && news.image !== "None" ? news.image : "https://via.placeholder.com/400x200?text=No+Image";

                    const newsHtml = `
                        <div class="col">
                            <div class="card news-card">
                                <img data-src="${imageUrl}" class="card-img-top lazy-img" alt="${news.title}">
                                <div class="card-body">
                                    <h5 class="card-title">${news.title}</h5>
                                    <p class="card-text">${news.description || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù…ØªØ§Ø­"}</p>
                                    <a href="${news.url}" target="_blank" class="btn btn-sm btn-primary">Ø§Ù‚Ø±Ø£ Ø§Ù„Ù…Ø²ÙŠØ¯</a>
                                </div>
                            </div>
                        </div>`;

                    newsContainer.innerHTML += newsHtml;
                    validNewsCount++; 
                });

                lazyLoadImages();
            }

            function lazyLoadImages() {
                const lazyImages = document.querySelectorAll(".lazy-img");
                lazyImages.forEach(img => {
                    if (!img.dataset.loaded) {
                        img.src = img.dataset.src;
                        img.dataset.loaded = true;
                    }
                });
            }
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ© ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø© -->
    <footer>
        <p>Â© 2025 .Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
    </footer>
</body>
</html>